# ‚úÖ –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è - ‚úÖ –í–°–ï –£–°–¢–ê–ù–û–í–õ–ï–ù–´
- `SUPABASE_URL`: ‚úÖ https://mzicwglcvhszxgxpnbse.supabase.co
- `ANON_KEY`: ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `SERVICE_ROLE_KEY`: ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ‚úÖ –£—Å–ø–µ—à–Ω–æ
- –¢–∞–±–ª–∏—Ü–∞ `tenants`: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞
- –¢–∞–±–ª–∏—Ü–∞ `app_users`: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞
- –í—Å–µ 10 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã: ‚úÖ

### 3. SQL INSERT - ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
```sql
INSERT INTO tenants (name) VALUES ('Test') RETURNING *;
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–æ–∑–¥–∞–µ—Ç tenant —Å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö –ø–æ–ª–µ–π

### 4. Trigger - ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
–¢—Ä–∏–≥–≥–µ—Ä `fill_tenant_defaults` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç:
- `plan_tier` ‚Üí 'free'
- `max_users` ‚Üí 5
- `max_storage_mb` ‚Üí 100
- `max_api_calls` ‚Üí 1000
- `settings` ‚Üí '{}'

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ PostgREST –∫—ç—à

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
PostgREST API (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase JS SDK) –≤–∏–¥–∏—Ç –°–¢–ê–†–£–Æ —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã `tenants` –≥–¥–µ `plan_tier` –±—ã–ª NOT NULL –±–µ–∑ default.

### –ü–æ—á–µ–º—É —Ç–∞–∫:
–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π PostgREST –Ω–µ –æ–±–Ω–æ–≤–∏–ª –∫—ç—à —Å—Ö–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ —á–µ—Ä–µ–∑ `adminClient.from('tenants').insert()` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
null value in column "plan_tier" violates not-null constraint
```

–ù–æ –ø—Ä—è–º–æ–π SQL INSERT —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## ‚úÖ –†–ï–®–ï–ù–ò–Ø

### –†–µ—à–µ–Ω–∏–µ 1: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å PostgREST (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç **Sale Pro**
3. Settings (‚öôÔ∏è) ‚Üí API
4. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑
5. –ù–∞–∂–º–∏—Ç–µ **"Restart API server"** –∏–ª–∏ **"Reload schema"**
6. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç!**

### –†–µ—à–µ–Ω–∏–µ 2: –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 –º–∏–Ω—É—Ç

PostgREST –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫—ç—à —á–µ—Ä–µ–∑ ~10 –º–∏–Ω—É—Ç.

### –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL –Ω–∞–ø—Ä—è–º—É—é (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

–ö–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç trigger –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –ø–æ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ PostgREST —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

---

## üéØ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–°

### ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞:
- 10 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- Helper —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- –¢—Ä–∏–≥–≥–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- Service role keys —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### ‚úÖ SQL –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç:
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ tenant
INSERT INTO tenants (name) VALUES ('My Company');

-- –°–æ–∑–¥–∞–Ω–∏–µ app_users
INSERT INTO app_users (id, tenant_id, email, role)
VALUES (...);
```

### ‚è≥ REST API —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:
–ó–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ PostgREST (1 –º–∏–Ω—É—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π).

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ PostgREST (1 –º–∏–Ω—É—Ç–∞)
- Dashboard ‚Üí Settings ‚Üí API ‚Üí Reload schema

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
npm run dev
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000/register
- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É
- –ù–∞–∂–º–∏—Ç–µ "Create Account"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/app`

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| Service Role Key | ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (10 —Ç–∞–±–ª–∏—Ü) | ‚úÖ –°–æ–∑–¥–∞–Ω–∞ |
| RLS –ø–æ–ª–∏—Ç–∏–∫–∏ | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã |
| Helper —Ñ—É–Ω–∫—Ü–∏–∏ | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç |
| –¢—Ä–∏–≥–≥–µ—Ä—ã | ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã |
| SQL INSERT | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| REST API (—á–µ—Ä–µ–∑ PostgREST) | ‚è≥ –¢—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ |
| –ö–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ | ‚úÖ –ì–æ—Ç–æ–≤ |
| –ö–æ–¥ –≤—Ö–æ–¥–∞ | ‚úÖ –ì–æ—Ç–æ–≤ |
| Dashboard | ‚úÖ –ì–æ—Ç–æ–≤ |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü—Ä–æ–µ–∫—Ç:
- URL: https://mzicwglcvhszxgxpnbse.supabase.co
- –ù–∞–∑–≤–∞–Ω–∏–µ: Sale Pro

### –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
1. `0001_init` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã
2. `0002_training_content_richtext` - Rich text –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
3. `fix_app_users_schema` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ app_users
4. `add_tenants_service_role_policy` - –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è service_role
5. `fix_tenants_plan_tier` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ plan_tier –∫–æ–ª–æ–Ω–∫–∏
6. `drop_plan_tier_constraint` - –£–¥–∞–ª–µ–Ω–∏–µ constraint
7. `add_create_tenant_function` - SQL —Ñ—É–Ω–∫—Ü–∏—è
8. `add_tenant_insert_trigger` - Trigger –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ tenants:
```sql
CREATE TABLE tenants (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  plan_tier TEXT DEFAULT 'free',      -- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  max_users INTEGER DEFAULT 5,         -- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  max_storage_mb INTEGER DEFAULT 100,  -- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  max_api_calls INTEGER DEFAULT 1000,  -- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  stripe_customer_id TEXT,             -- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  settings JSONB DEFAULT '{}',         -- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!**

–ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ –∫—ç—à–µ PostgREST API, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é —Å—Ö–µ–º—É.

**–†–µ—à–µ–Ω–∏–µ: 1 –º–∏–Ω—É—Ç–∞ –Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É PostgREST –≤ Dashboard.**

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
- `–ù–ê–ß–ê–õ–û_–†–ê–ë–û–¢–´.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å—Ç–∞—Ä—Ç—É
- `–ë–´–°–¢–†–´–ô_–°–¢–ê–†–¢.txt` - 3 —à–∞–≥–∞ –¥–æ —Ä–∞–±–æ—Ç—ã
- `POSTGREST_CACHE_FIX.md` - –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
- `–ö–ê–ö_–ü–û–õ–£–ß–ò–¢–¨_SERVICE_ROLE_KEY.txt` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞

---

**–í—Ä–µ–º—è –¥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: 1 –º–∏–Ω—É—Ç–∞** ‚è±Ô∏è

–ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ PostgREST –≤ Dashboard!
