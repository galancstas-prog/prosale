# Инструкция по исправлению проблем

## Что было исправлено

### Модуль "Обучение"
✅ Теперь показывает ошибки при создании документов
✅ Добавлено детальное логирование ошибок
✅ Добавлена валидация контента

### Модуль "База знаний"
✅ Теперь показывает ошибки при создании документов
✅ Добавлено детальное логирование ошибок
✅ Улучшена обработка ошибок

## Главное действие: Примените миграцию базы данных!

Скорее всего, документы не создаются потому что **таблицы в базе данных не созданы**.

### Как применить миграцию:

1. Откройте файл **`APPLY_DATABASE_MIGRATION.sql`** в этом проекте
2. Скопируйте **весь код** из этого файла
3. Перейдите на https://supabase.com/dashboard
4. Выберите ваш проект
5. Нажмите **SQL Editor** в левом меню
6. Нажмите **New Query**
7. Вставьте скопированный код
8. Нажмите **Run** (кнопка запуска)
9. Дождитесь сообщения об успехе

## Как теперь увидеть ошибки

После этих исправлений, любые ошибки будут:

1. **Показываться в интерфейсе** - красное окно с текстом ошибки
2. **Выводиться в консоль браузера** (F12 → Console)
3. **Логироваться на сервере** - проверьте логи вашего сервера

## Типичные ошибки, которые вы можете увидеть

### Если не применена миграция:
```
Database error: relation "training_docs" does not exist
```
или
```
Database error: relation "kb_pages" does not exist
```

**Решение:** Примените миграцию из файла `APPLY_DATABASE_MIGRATION.sql`

### Если пустое содержимое:
```
Content is required
```

**Решение:** Заполните поле с содержимым документа

### Если пустой заголовок:
```
Title is required
```

**Решение:** Введите название документа

## Проверка что всё работает

### Шаг 1: Проверьте что таблицы созданы

Выполните этот SQL-запрос в Supabase SQL Editor:

```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;
```

Вы должны увидеть эти таблицы:
- ✅ categories
- ✅ script_threads
- ✅ script_turns
- ✅ training_docs
- ✅ training_progress
- ✅ faq_items
- ✅ kb_pages

### Шаг 2: Попробуйте создать документ

1. Откройте модуль "Обучение"
2. Создайте категорию (если её нет)
3. Зайдите в категорию
4. Нажмите "New Training Document"
5. Введите название и содержимое
6. Нажмите "Create Document"

Если появится ошибка - она будет показана в красном окне!

### Шаг 3: То же самое для Базы знаний

1. Откройте "База знаний"
2. Нажмите "New Page"
3. Введите название и содержимое
4. Нажмите "Create Page"

## Статус сборки

✅ Проект успешно собирается
✅ Все исправления применены
✅ TypeScript ошибок нет

## Если проблема остаётся

Проверьте:

1. **Применена ли миграция?** - Выполните SELECT запрос выше
2. **Правильные ли env переменные?** - Проверьте NEXT_PUBLIC_SUPABASE_URL и NEXT_PUBLIC_SUPABASE_ANON_KEY
3. **Какая ошибка показывается?** - Теперь все ошибки видны в интерфейсе
4. **Логи сервера** - Ошибки пишутся в console.error, проверьте логи

## Файлы с подробной информацией

- **`FINAL_FIXES.md`** - Детальное описание на английском
- **`APPLY_DATABASE_MIGRATION.sql`** - SQL код для создания таблиц
- **`FIXES_APPLIED.md`** - Список всех предыдущих исправлений
